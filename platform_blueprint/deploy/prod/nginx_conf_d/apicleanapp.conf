server {

        listen 443 ssl;
        server_name api.cleanapp.io www.api.cleanapp.io;

        ssl_certificate /etc/nginx/conf.d/STAR_cleanapp_io_chain.crt;
        ssl_certificate_key /etc/nginx/conf.d/STAR_cleanapp_io.key;
        ssl_session_cache shared:SSL:10m;

        # Legacy mobile backend (cleanapp_service) endpoints behind TLS.
        # Exact-match locations avoid colliding with customer-service routes.
        location = /help { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /update_or_create_user { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /report { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /read_report { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_map { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_stats { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_teams { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_top_scores { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /update_privacy_and_toc { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /read_referral { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /write_referral { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /generate_referral { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_blockchain_link { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_actions { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_action { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /create_action { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /update_action { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /delete_action { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /update_user_action { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_areas { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /valid-reports-count { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /create_or_update_area { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }
        location = /get_reports_by_lat_lon { proxy_pass http://127.0.0.1:8079; proxy_set_header Host $host; proxy_read_timeout 60; proxy_redirect http:// https://; }





        location / {
                proxy_pass http://127.0.0.1:9080;
                proxy_set_header Host $host;

                # re-write redirects to http as to https, example: /home
                proxy_redirect http:// https://;
        }
}

# HTTP listener on port 8080 for api.cleanapp.io -> cleanapp_service
server {
        listen 8080;
        server_name api.cleanapp.io;

        location / {
                proxy_pass http://127.0.0.1:8079;
                proxy_set_header Host $host;
                proxy_read_timeout 60;
        }
}
