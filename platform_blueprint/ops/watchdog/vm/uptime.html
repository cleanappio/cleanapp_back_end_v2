<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CleanApp Uptime</title>
    <style>
      :root {
        --bg: #0b1220;
        --panel: rgba(255, 255, 255, 0.06);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.65);
        --ok: #22c55e;
        --warn: #f59e0b;
        --fail: #ef4444;
        --border: rgba(255, 255, 255, 0.12);
        --shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji",
          "Segoe UI Emoji";
        background:
          radial-gradient(1200px 600px at 20% 10%, rgba(34, 197, 94, 0.18), transparent 60%),
          radial-gradient(1000px 500px at 80% 30%, rgba(59, 130, 246, 0.16), transparent 55%),
          radial-gradient(900px 500px at 50% 90%, rgba(245, 158, 11, 0.14), transparent 55%),
          var(--bg);
        color: var(--text);
      }
      .wrap {
        max-width: 1100px;
        margin: 42px auto;
        padding: 0 20px;
      }
      header {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 20px;
        margin-bottom: 18px;
      }
      h1 {
        font-size: 26px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      .meta {
        font-size: 13px;
        color: var(--muted);
        white-space: nowrap;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        box-shadow: var(--shadow);
      }
      .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--muted);
        box-shadow: 0 0 0 5px rgba(255, 255, 255, 0.06);
      }
      .dot.ok {
        background: var(--ok);
        box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.18);
      }
      .dot.warn {
        background: var(--warn);
        box-shadow: 0 0 0 6px rgba(245, 158, 11, 0.18);
      }
      .dot.fail {
        background: var(--fail);
        box-shadow: 0 0 0 6px rgba(239, 68, 68, 0.18);
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 14px;
      }
      .card {
        grid-column: span 12;
        border: 1px solid var(--border);
        background: var(--panel);
        border-radius: 16px;
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .card h2 {
        margin: 0;
        padding: 14px 16px;
        font-size: 14px;
        letter-spacing: 0.25px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.85);
        background: linear-gradient(90deg, rgba(34, 197, 94, 0.22), rgba(34, 197, 94, 0.06));
        border-bottom: 1px solid var(--border);
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      td,
      th {
        padding: 12px 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        font-size: 14px;
      }
      th {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.22px;
        color: var(--muted);
        text-align: left;
      }
      tr:last-child td {
        border-bottom: none;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .status {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
      }
      .muted {
        color: var(--muted);
      }
      a {
        color: rgba(147, 197, 253, 0.95);
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      .error {
        padding: 14px 16px;
        color: rgba(255, 255, 255, 0.9);
      }
      @media (min-width: 860px) {
        .card.split {
          grid-column: span 6;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <div>
          <h1>CleanApp Uptime</h1>
          <div class="meta">Public, secrets-safe status snapshot for core services and pipelines.</div>
        </div>
        <div class="badge" id="overallBadge" title="Derived from check statuses">
          <span class="dot" id="overallDot"></span>
          <span id="overallText">Loading…</span>
        </div>
      </header>

      <div class="grid">
        <section class="card">
          <h2>Checks</h2>
          <div id="checksRoot">
            <div class="error">Loading…</div>
          </div>
        </section>
      </div>
    </div>

    <script>
      const STATUS_URL = "/uptime.json";

      function statusClass(s) {
        if (s === "ok") return "ok";
        if (s === "warn") return "warn";
        return "fail";
      }

      function overallText(s) {
        if (s === "ok") return "Operational";
        if (s === "degraded") return "Degraded";
        return "Down";
      }

      function renderChecks(payload) {
        const root = document.getElementById("checksRoot");
        if (!payload || !Array.isArray(payload.checks)) {
          root.innerHTML = '<div class="error">Invalid status payload.</div>';
          return;
        }

        const generatedAt = payload.generated_at || "";
        const overall = payload.overall_status || "down";

        const badgeText = document.getElementById("overallText");
        const dot = document.getElementById("overallDot");
        badgeText.textContent = `${overallText(overall)} · updated ${generatedAt}`;
        dot.className = `dot ${overall === "ok" ? "ok" : overall === "degraded" ? "warn" : "fail"}`;

        const rows = payload.checks
          .map((c) => {
            const s = statusClass(c.status);
            const link = c.link
              ? `<a href="${c.link}" target="_blank" rel="noreferrer noopener">open</a>`
              : `<span class="muted">—</span>`;
            const details = c.details ? String(c.details) : "—";
            return `
              <tr>
                <td>
                  <div class="pill">
                    <span class="dot ${s}"></span>
                    <span>${c.name}</span>
                  </div>
                </td>
                <td class="status">${c.status}</td>
                <td class="muted">${details}</td>
                <td>${link}</td>
              </tr>
            `;
          })
          .join("");

        root.innerHTML = `
          <table>
            <thead>
              <tr>
                <th>Component</th>
                <th>Status</th>
                <th>Details</th>
                <th>Link</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>
        `;
      }

      async function refresh() {
        const root = document.getElementById("checksRoot");
        try {
          const res = await fetch(STATUS_URL, { cache: "no-store" });
          if (!res.ok) throw new Error(`http ${res.status}`);
          const payload = await res.json();
          renderChecks(payload);
        } catch (err) {
          root.innerHTML = `<div class="error">Failed to load ${STATUS_URL}: ${String(err)}</div>`;
          const badgeText = document.getElementById("overallText");
          const dot = document.getElementById("overallDot");
          badgeText.textContent = "Status unavailable";
          dot.className = "dot fail";
        }
      }

      refresh();
      setInterval(refresh, 30_000);
    </script>
  </body>
</html>

