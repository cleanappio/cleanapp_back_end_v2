package main

import (
	"cleanapp/backend/email"
	"encoding/json"
	"os"

	"github.com/apex/log"
	geojson "github.com/paulmach/go.geojson"
)

func main() {
	feature := &geojson.Feature{}
	js := `
	{
			"id": "way/857573700",
			"type": "Feature",
			"geometry": {
				"type": "Polygon",
				"coordinates": [
					[
						[
							8.9129649,
							49.1378759
						],
						[
							8.9128589,
							49.1377162
						],
						[
							8.9127463,
							49.1375467
						],
						[
							8.9126905,
							49.1374848
						],
						[
							8.9125513,
							49.1373302
						],
						[
							8.9123312,
							49.1370838
						],
						[
							8.9123246,
							49.1370467
						],
						[
							8.9124457,
							49.1369382
						],
						[
							8.9125986,
							49.1367642
						],
						[
							8.9127943,
							49.136544
						],
						[
							8.913071,
							49.1362526
						],
						[
							8.9131512,
							49.1361717
						],
						[
							8.9125279,
							49.1359231
						],
						[
							8.9117647,
							49.1357245
						],
						[
							8.9112171,
							49.1356641
						],
						[
							8.9111691,
							49.1356504
						],
						[
							8.911288,
							49.1355659
						],
						[
							8.9114378,
							49.1355323
						],
						[
							8.911597,
							49.1355536
						],
						[
							8.9116564,
							49.1355952
						],
						[
							8.9118307,
							49.1356218
						],
						[
							8.9120499,
							49.1356782
						],
						[
							8.912129,
							49.1356809
						],
						[
							8.9123356,
							49.1357259
						],
						[
							8.9127417,
							49.1358581
						],
						[
							8.9133656,
							49.1360682
						],
						[
							8.9139733,
							49.1362719
						],
						[
							8.9143073,
							49.1364194
						],
						[
							8.9144531,
							49.1365037
						],
						[
							8.9145159,
							49.1365672
						],
						[
							8.9145846,
							49.1366359
						],
						[
							8.9146166,
							49.1366951
						],
						[
							8.9146082,
							49.1367589
						],
						[
							8.9145408,
							49.1368874
						],
						[
							8.9144823,
							49.1369817
						],
						[
							8.9143868,
							49.1371341
						],
						[
							8.914275,
							49.1372845
						],
						[
							8.9142438,
							49.1373157
						],
						[
							8.9142234,
							49.137331
						],
						[
							8.9141845,
							49.1373592
						],
						[
							8.9132944,
							49.1379192
						],
						[
							8.9129649,
							49.1378759
						]
					]
				]
			},
			"properties": {
				"@id": "way/857573700",
				"email": "info@gartenschau-eppingen.de",
				"leisure": "park",
				"name": "Weiherpark",
				"operator": "Stadt Eppingen",
				"website": "https://www.gartenschau-eppingen.de/"
			}
		}
	`
	json.Unmarshal([]byte(js), feature)

	img, err := email.GeneratePolygonImg(feature, 49.1373592, 8.9141845)
	if err != nil {
		log.Errorf("Error generating the image: %w", err)
	}

	f, err := os.Create("./mapimg.png")
	if err != nil {
		log.Errorf("Error opening output file: %w", err)
	}
	defer f.Close()

	f.Write(img)
}